############################################################
#
# corpc Makefile
# Generated by amyznikov Sep 8, 2016
#   from 'linux-gcc-executable' template
#
############################################################

SHELL = /bin/bash

TARGET = callback-server

all: $(TARGET)


cross   =
sysroot =
DESTDIR =
prefix  = /usr/local
bindir  = $(prefix)/bin
incdir  = $(prefix)/include
libdir  = $(prefix)/lib



PROTO = smaster
PROTO_PATH = ../proto
PROTO_HEADERS += $(addprefix $(PROTO_PATH)/,  $(PROTO).pb.h  $(PROTO).corpc.h)
PROTO_SOURCES += $(addprefix $(PROTO_PATH)/,  $(PROTO).pb.c  $(PROTO).corpc.c)



INCLUDES+= -I. -I$(PROTO_PATH) -I$(CURDIR)/../../../../include

SOURCES = $(wildcard *.c) ../proto/smaster.c $(PROTO_SOURCES)
HEADERS = $(wildcard *.h) ../proto/smaster.h $(PROTO_HEADERS)
MODULES = $(foreach s,$(SOURCES),$(addsuffix .o,$(basename $(s))))


# C preprocessor flags
CPPFLAGS=$(DEFINES) $(INCLUDES)

# C Compiler and flags
CC = $(cross)gcc
CFLAGS= -Wall -Wextra -O3 -g0


# PROTOC
PROTOC = ../../../../corpc-pb-gen/corpc-pb-gen

# Loader Flags And Libraries
LD=$(CC)
LDFLAGS = $(CFLAGS)

# STRIP = $(cross)strip --strip-all
STRIP = @echo "don't strip "

LIBCUTTLE=../../../../libcuttle.a

LDLIBS += $(LIBCUTTLE) -L/usr/local/lib /usr/local/lib/libpcl.a -lssl -lcrypto -lpthread


#########################################


$(MODULES): $(HEADERS) Makefile
$(TARGET) : $(MODULES) $(LIBCUTTLE) Makefile
	$(LD) $(LDFLAGS) $(MODULES) $(LDLIBS) -o $@

clean:
	$(RM) $(MODULES)

distclean: clean
	$(RM) $(TARGET)

install: $(TARGET) $(DESTDIR)/$(bindir)
	cp $(TARGET) $(DESTDIR)/$(bindir) && $(STRIP) $(DESTDIR)/$(bindir)/$(TARGET)

uninstall:
	$(RM) $(DESTDIR)/$(bindir)/$(TARGET)


$(DESTDIR)/$(bindir):
	mkdir -p $@

.PRECIOUS: $(PROTO_PATH)/%.corpc.c
$(PROTO_PATH)/%.corpc.c: $(PROTO_PATH)/%.proto
	$(PROTOC) -I$(PROTO_PATH) --corpc_out=$(PROTO_PATH) $<

.PRECIOUS: $(PROTO_PATH)/%.pb.c
$(PROTO_PATH)/%.pb.c: $(PROTO_PATH)/%.proto
	$(PROTOC) -I$(PROTO_PATH) --c_out=$(PROTO_PATH) $<
